#전자메일 #SMTP

*Simple Mail Transfer Protocol(단순 전자우편 전송 프로토콜)*
**인터넷을 통해 이메일 메시지를 보내고 받는 데 사용 되는 통신 프로토콜**

### 인터넷 이메일 시스템 구조

![[인터넷 이메일 시스템 구조.jpeg|400]]
user agent : 개인이 메일을 읽거나 쓸때 사용, 관리 기능 수행
mail server : 다수 사용자들의 메일 박스 관리, 메일 송/수신 제어

==메일 서버들 간에 통신을 지원하는 프로토콜이 SMTP==
*메일을 전송만 하지 다운로드하는 기능은 없다*

#### 동작 과정

![[동작 과정.jpeg]]

	1️⃣ 송수신자 user agent에서 메일 작성 후 서버로 전송
	2️⃣ 송수신자 메일 서버의 출력 메세지 큐에 저장
	3️⃣ 수신자 메일 서버로 전송
	4️⃣ 전송 불가시 30분 단위로 재전송 시도, 정해진 기간 동안 전송 불가시 중단 및 송수신자에서 통보
	5️⃣ 수신자 메일 서버의 수신자 메일 박스에 저장
	6️⃣ 수신자 user agent에서 메일 서버의 메일 박스의 메일 읽기 및 관리

> 수신자가 user agent가 자신의 메일 박스에 있는 메세지를 가져갈때는 SMTP를 쓰는게 아니라 별도의 mail access protocol을 사용함
> 
> 수신자 user agent는 mail server와 다르게 항상 켜져있는 것이 아니기에 SMTP로 push방식을 사용하는 것이 아니라 다른 메일 프로토콜로 pull방식으로 받는다 (ex. POP, IMAP, HTTP)

---
### SMTP

-  클라이언트 - 서버 프로토콜
	- 응용 계층 구조는 클라이언트 - 서버 구조와 P2P구조가 있는데 SMTP는 클라이언트 - 서버
	- 클라이언트 : 송신 메일 서버 / user agent
	- 서버 : 수신 서버 메일 / 송신 메일 서버
	
-  TCP 사용
	- 신뢰 전송을 위함
	- 서버 포트 번호 : 25
		- *HTTP는 80
	
-  ASCII 텍스트 프로토콜
	- SMTP는 명령어나 메일 메세지 모두 단순 7비트 ASCII여야 함
	- SMTP가 약 1980년대쯤 나온 오래된 프로토콜로 과거에는 문자열이기 떄문에 ASCII가 단점이 되지 않았지만 오늘날 이미지, 오디오, 동영상 등 멀티미디어 시대기에 메일 메세지를 ASCII로 변환하고 전송하고 전송된 ASCII 메세지를 또 원래 메세지로 변환해야 함 ~~낡았다~~
	- 참고로 HTTP는 전송 전에 멀티미디어 데이터를 ASCII로 변환하지 않음


#### 프로토콜 동작 절차

![[동작 절차.png|500]]

	1️⃣ 처음 TCP 연결 설정. 연결이 설정되면 서버와 클라이언트는 애플리케이션 계층 핸드쉐이크를 수행
	2️⃣ 클라이언트가 송신자와 수신자의 전자 메일 주소를 제공
	3️⃣ 연결 설정 이후 메세지 전송
	4️⃣ 메세지를 다 보냈다면 명령어로 닫음

메일 전송 부분을 더 자세하게 보자면...

![|500](https://mblogthumb-phinf.pstatic.net/20110810_227/eqelizer_1312908510459_8kvr5N_png/080911_1648_04SMTPSimpl2.png?type=w420)

	1️⃣ MAIL FORM : 송신자 메일 주소 -> 250 ok 응답 받음
	2️⃣ RCPT To : 수신자 메일 주소 -> 250 ok 응답 받음
	3️⃣ DATA : 데이터 전송 시작 명령어
	4️⃣ 354 응답으로 데이터 input 시작
	5️⃣ '.'하나만 보내 메세지 전송이 끝났음을 알려줌 -> 250 ok 응답

	메세지들간을 구분하기 위해 보이진 않지만 메세지 끝에 아스키코드 제어문자인 <CF><LF>을 붙임

[ASCII는 MIME을 이용해서 변환됨](https://ko.wikipedia.org/wiki/MIME)

![[전달 과정 예.jpeg]]

### 메세지 포켓

![[메세지 포켓.png|500]]

### 명령어

![[명령어 모음.png|500]]
### 참고
https://blog.naver.com/eqelizer/20134840619
https://nordvpn.com/ko/blog/smtp-protocol/
James F. Kurose, Keith W. Ross '컴퓨터 네트워킹 하양식 접근 8판', 최종원 외 7인, 퍼스트북(2022) 
[컴퓨터 네트워크 제 9강 이메일과 SMTP](https://www.youtube.com/watch?v=maNnhEw4bzk)

