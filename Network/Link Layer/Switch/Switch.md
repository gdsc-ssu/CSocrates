#네트워크_2계층 #패킷
## 학습 목표
- Switch에 대한 개념을 공부한다.
- Switch와 Router의 차이점을 알 수 있다.
### Switch란?
스위치는 2개 이상의 IT 디바이스가 서로 통신하도록 허용하는 장비이다.
이더넷 프레임을 [[MAC]] 주소 기반으로 스위칭하고 포워딩한다.
1. 프레임 포워딩
2. MAC 주소 학습
3. 콜리전 도메인 분리
4. 플로우 컨트롤
5. VLAN
6. STP (Spanning Tree Protocol)
또한 내부에서 사용할 수 있는 기능은 5가지가 있다.
1. Learning
2. Flooding
3. Fowarding
4. Filtering
5. Aging
또한 라우터를 L3 스위치라고 말하기도 하는데, 단순하게 기기끼리 네트워크 연결이 이루어지게 하는 기기라면 스위치라고 할 수 있기 때문입니다.

### 어떻게 작동하는가?
디바이스 간에 통신하는 방식은 스위치 자체를 포함하여 연결된 모든 시스템이 표준 통신 프로토콜 세트를 따르도록 하는 것이다. 이러한 표준은 IEEE 및 IETF 등의 국제 표준 기구가 정의하고 관리한다.
통신은 패킷 단위로 이루어지고, 패킷은 헤더와 페이로드를 포함하고 있는데 헤더에는 해당 통신에 참여하는 디바이스의 출발지 및 목적지 주소와 같은 정보가 들어 있고, 페이로드에는 네트워크상의 디바이스가 실제로 교환하려는 데이터가 들어 있습니다. 네트워크상의 각 디바이스에는 패킷을 보낼 수 있는 주소가 한 개 이상 있습니다.
스위치는 패킷 헤더의 주소를 읽은 다음 이 패킷을 해당되는 목적지로 전달한다.

### 왜 사용하는가?
스위치는 네트워크상에서 사용자와 [[어플라이언스]] 및 장비를 연결하여 이들이 서로 통신하고 리소스를 공유할 수 있게 한다.

스위치의 중요한 역할은 "가상 네트워크"을 생성하는 것이다. 가상 네트워크는 네트워크 관리자가 제공하는 구성에 따라 네트워크 연결된 시스템을 여러 그룹으로 나누어 분리가 가능하다.
특정 시스템을 나머지 시스템으로부터 안전하게 분리하면서 다수의 시스템을 한 개의 물리적 네트워크에 연결할 수 있다. 
가상 네트워크 유형에는 VPN(Virtual Private Network), 가상 LAN(VLAN) 등이 있다.

### Learning (MAC 주소 학습 방법)
1. 프레임 수신
	1. 스위치는 프레임을 수신하고, 해당 프레임은 출발지 MAC 주소, 목적지 MAC 주소를 담고 있다.
2. 출발지 MAC 주소 학습
	- 스위치는 수신한 프레임의 출발지 MAC 주소를 확인하고, 이 주소와 프레임을 수신한 포트 번호를 연결하여 MAC 주소 테이블에 저장한다. 이를 통해 스위치는 특정 MAC 주소가 어떤 포트와 연결되어 있는지 학습한다.
3. MAC 주소 테이블 업데이트
	- 스위치는 지속적으로 네트워크 통신을 모니터링하며, 새로운 MAC 주소를 학습하고 기존의 MAC 주소 정보를 업데이트합니다. 만약 특정 MAC 주소로부터 오랜 시간 동안 통신이 없다면, 해당 MAC 주소 정보는 테이블에서 제거될 수 있습니다.
4. 프레임 전달
	- 스위치는 수신한 프레임의 목적지 MAC 주소를 확인하고, MAC 주소 테이블을 참조하여 해당 주소가 어떤 포트에 연결되어 있는지 확인하고 프레임을 해당 포트로 전달한다. 만약 목적지 MAC 주소가 테이블에 없다면, 스위치는 프레임을 모든 포트로 전달하여 올바른 목적지를 찾습니다(Flooding).

### Flooding
예를 들어 PC 1번에서 PC 2번으로 통신을 요청하는데, 그 중간에 있는 Switch의 MAC Table에 2번 PC의 MAC 주소가 저장되어 있지 않다면, 자신과 연결된 모든 포트에게 요청을 보냅니다.
이 기능을 flooding이라고 하고, 이것을 통해서 자신이 해당하는 MAC 주소라면 reply를 제공하고, 이를 통해 목적지 MAC주소를 알 수 있습니다.
### Fowarding
가장 중요한 기능인 프레임 포워딩입니다.
스위치는 2개 이상의 기기가 연결되어 있고, 목적지의 주소를 알고 있다면 목적지까지 Frame을 이동하도록 만들 수 있습니다.
### Filtering
데이터를 보낼 때 출발 MAC주소, 도착 MAC주소를 명시해서 보낼 텐데, 만약 양끝점 주소가 MAC 주소 테이블에 존재한다면 해당 맥 주소가 아닌 주소들에게는 데이터를 보내지 않습니다.
### Aging
맥 주소 테이블을 영원이 유지할 수는 없습니다.
따라서 맥 주소에 대한 유효시간을 놔둡니다.
해당 시간이 만료되면 맥 주소 테이블에서 삭제합니다.

### VLAN
VLAN이란 Virtual LAN으로서 물리적 배치와 상관없이 LAN을 논리적으로 분할, 구성하는 기술이다.
각 VLAN은 별도의 네트워크가 됨으로, VLAN간의 통신에는 3계층의 도움이 필요하다.
Trunking을 통해서 Tagged Port를 사용해 VLAN 사이에서 패킷을 주고 받을 수 있다.
이더넷 프레임에 VLAN ID 필드를 추가하여 태그 정보를 사용할 수 있다.
![[Pasted image 20231011193912.png]]
태그를 보낼 때는 VLAN ID를 붙이고, 수신측에서 VLAN ID를 제거하여 VLAN ID의 VLAN으로 패킷을 전송할 수 있다.
+) ![[Pasted image 20231011194023.png]] 
VLAN을 사용하면 MAC 테이블에서도 VLAN 값이 함께 기록된다.
### stp
https://net-study.club/entry/%EC%8A%A4%ED%8C%A8%EB%8B%9D-%ED%8A%B8%EB%A6%AC-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9CSTP-Spanning-Tree-Protocol

### Switch와 [[Router]]의 차이점
둘 다 데이터를 특정한 목적지로 이동시킨다는 점에서는 동일하다.
목적지가 불분명한 경우(테이블에 없는 경우), 스위치는 브로드캐스트를 통해 주변 노드에게 퍼뜨리지만 라우터는 해당 값을 버린다. 
### reference
https://www.cloudflare.com/ko-kr/learning/network-layer/what-is-a-network-switch/