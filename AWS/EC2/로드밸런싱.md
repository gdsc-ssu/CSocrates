#AWS
### 출처
* [로드밸런서란?](https://aws.amazon.com/ko/what-is/load-balancing/)
* [로드밸런서가 하는 일](https://co-no.tistory.com/entry/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC-%EB%A1%9C%EB%93%9C%EB%B0%B8%EB%9F%B0%EC%8B%B1)
___
### 개요
* [[#로드밸런싱이란]]
* [[#로드밸런싱을 왜 하나요?]]
* [[#로드밸런서]]
* [[#로드밸런싱은 어떻게 하나요?]]
* [[#로드밸런서의 종류]]
___
### 로드밸런싱이란

**LoadBalancing은 유저 요청으로 발생하는 트래픽이나 요청 부하를 균등하게 분할하는 기법으로 하나의 리소스에만 집중적으로 요청이 발생해 부하가 생기는 현상을 방지 해준다.**

간단하게 생각하면 은행 창구의 번호표 시스템을 떠올리면 된다. 은행에 방문하면 번호표를 기준으로 직원 별로 균등하게 업무가 분담되는 것을 확인할 수 있었을 것이다. 이 번호표 기반으로 균등하게 고객을 은행원들에게 할당 해주는 행위가 로드밸런싱이 된다.

> [!info]
> 로드밸런싱을 활용하면 인스턴스의 부담을 덜고 균등하게 부하를 가져갈 수 있다.

___
### 로드밸런싱을 왜 하나요?

로드밸런싱을 하게 되는 상세한 이유는 다양하나 근본적인 원인은 하나이다. **스케일 업에 한계가 존재한다는 점이다.** 하나의 서버가 거대해지는 것에는 명확한 한게가 존재하고 이에 따라 머신을 여러 개로 분리해야 할 상황이 필연적으로 발생한다.

여러 대의 머신에게 적절히 업무를 분담하기 위해서는 적절하게 요청을 할당해줘야 하고 이로 인해 로드밸런싱이 탄생하게 됐다. (이외에도 머신이 여러 대로 분리돼야 할 이유는 차고 넘친다.)

> [!info]
> Scale-UP의 한계가 명백하므로 Scale-Out이 필요하고 이를 위해서는 로드 밸런싱이 필수적이다.

___
### 로드밸런서

로드밸런서는 로드밸런싱을 담당하는 주체로 서버 보다 앞단에 위치해 우선적으로 요청을 파악하고 적절히 분담하는 작업을 수행한다.  

==**로드밸런서는 서버에 요청을 전달하기 이전에 서버의 상태를 파악하고 여러 알고리즘을 활용해 가장 요청을 처리하기 적절한 서버에 요청을 전달한다.**==

서버에 요청을 전달하기 이전에 라는 말에 집중하자. 로드밸런서는 서버의 앞 단에 위치해 요청을 서버보다 먼저 전달받는 역할을 수행한다. 그림으로 보면 아래와 같다.

![[Pasted image 20240719211054.png]]
클라이언트는 각 서버의 실제 주소는 파악하지 못한채 로드밸런서의 주소 만을 파악할 수 있다. 이에따라 서버의 실제 주소를 클라이언트에게 숨길 수 있어 보안성을 높일 수 있다. 또한 실제 서버로 요청을 전달하기 이전에 검증 등의 작업을 수행할 수 있어 서버의 안전성을 높일 수 있다.

>[! 엥 이거 완전 리버스 프록시 아니야?]
>리버스 프록시가 수행할 수 있는 일 중 하나가 로드 밸런싱이다. 로드밸런서도 리버스 프록시 안에 포함된다는 것을 기억해두자.

위는 리버스 프록시의 기능이고 로드밸런서가 하는 일이 무엇인지 한번 확인해보자. 로드밸런서는 다음과 같은 작업을 수행한다.

* **헬스체크**
	서버들에 주기적으로 요청을 송신해 서버 들의 장애여부를 판별한다. 이후 정상작동 중인 서버로만 트래픽을 전송한다.
	
	너무 잦은 헬스체크는 오히려 오버헤드를 상승 시키므로 적절한 주기로 헬스체크를 진행할 필요가 존재한다.
* **NAT**
	사설<->공인 아이피 변환을 진행한다.
* **DSR**
	Desitination Network Address Translation의 약자로 서버에서 클라이언트로 트래픽이 돌아가는 경우 다시금 로드 밸런서를 거치지 않고 서버에서 곧장 전송을 진행하는 방식이다.
* **터널링**
	데이터를 캡슐화 해 요청을 전달 받는 서버만 해석 가능하게 한다.

___
### 로드밸런싱은 어떻게 하나요?

로드밸런싱 과정을 간략하게 압축하면 요청을 처리하기 가장 적절한 클라이언트를 선정하는 것이다. 로드밸런싱은 일반적으로 다음과 같은 알고리즘 등을 통해 진행된다.

* **라운드 로빈**
	순서대로 요청을 전달한다. 서버 스펙이 비슷하고 각 요청의 처리시간이 흡사한 경우에 유리하다.

* **최소 연결 방식**
	현재 연결된 세션 수가 가장 적은 서버에 요청을 할당하는 방식. 궁극적으로는 서버 별로 처리하는 세션의 수를 동일하게 설정한다.

* **리소스 기반 방식**
	리소스 기반 방식은 각 서버에서 동작 중인 에이전트로 부터 서버의 현재 리소스 현황을 전송 받고 이를 기반으로 가장 리소스가 여유있는 서버에 요청을 전달한다.
___
### 로드밸런서의 종류

**L4 로드밸런서**
4계층의 로드밸런서로 IP 또는 TCP 정보를 바탕으로 로드를 분산한다. IP 주소, 포트번호, MAC 주소, 전송 프로토콜에 따라 부하를 분담하는 것이 가능하다. 

**패킷의 내용을 살펴보진 않기 때문에 빠른 로드밸런싱이 가능하고 L7보다 저렴하다는 장점**이 존재한다. 반대로 패킷의 내용을 확인해 볼 수는 없기 때문에 구체적인 라우팅을 진행하는 것은 불가하다 (어플리케이션 프로토콜 기준 라우팅 등)

**L7 로드밸런서**
**어플리케이션의 로드밸런서로 쿠키, HTTP 헤더, URL 등을 전부 활용해 로드 밸런싱을 진행하는 것이 가능하다.** HTTPS 인증을 적용하는 것 또한 가능하다. 가격이 비싸고 패킷 복호화로 인한 보안 위험성과 속도가 느리다는 단점이 존재한다.
___


