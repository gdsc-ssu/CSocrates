>[!info] 목차
> - [[#문제 설명]]
> - [[#문제 추가 설명]]
> - [[#알아야하는 개념]]
> - [[#해결 방법]]
> - [[#참고]]
> - [[#참고 레퍼런스]]
### 문제 설명
NAT 게이트웨이 수를 줄이려고 모든 VPC에 전이 라우팅을 적용하여 외부 인터넷 트래픽을 하나의 공유 서비스 VPC를 통해 사용하고자 한다.
### 문제 추가 설명
- 비용 효율성
	- 각 VPC마다 NAT 게이트웨이를 생성하면 비용이 많이 발생한다.
	- 모든 VPC가 하나의 NAT 게이트웨이를 공유하는 구조를 만들면 비용 절감이 가능하다.
- 전이 라우팅(Transit Routing)
	- 전이 게이트웨이(Transit Gateway)를 활용하여 여러 VPC간 라우팅을 구현할 수 있다.
	- 모든 VPC 외부 트래픽을 공유 서비스 VPC로 라우팅하여 NAT 게이트웨이를 공유할 수 있다.
### 알아야하는 개념
- Transit Gateway [공식문서](https://docs.aws.amazon.com/ko_kr/vpc/latest/tgw/what-is-transit-gateway.html)
	- 여러 VPC 간의 연결을 중앙 집중화하여 네트워크 관리 용이하게 작업
	- 주요 기능
		- 중앙 집중식 라우팅 허브
			- 여러 VPC 연결을 중앙에서 관리
		- 트래픽 모니터링 & 제어
			- 중앙 집중화된 구조로 모니터링 및 제어가 쉬움
			- 보안 정책 일관되게 적용
		- 확장성
			- 다른 VPC 및 온프레미스 네트워크와 연결 및 확장이 쉬움
		- 비용 효율성
			- 트래픽을 하나의 지점으로 집중시켜 네트워크 대역폭 사용을 줄이고, 여러 개별 연결을 하지 않아 비용 절감 가능
	- 사용 사례
		- 온프레미스 데이터 센터와 클라우드 간 연결
		- 여러 지역 및 가용 영역에 걸친 클라우드 리소스 관리
		- VPC간 트래픽을 중앙에서 제어하고 모니터링
- Hub-Spoke 네트워크 토폴로지
	- Cloud Hub : 하나의 VPC가 모든 연결을 맺는 HUB VPC (중앙 관리용)
	- Spoke VPC : 온프레미스 혹은 다른 VPC
### 해결 방법
AWS TGW(Transit Gateway)를 배포하고, 모든 VPC에 대한 전송 게이트웨이 VPC 연결을 구성한다.
각 VPC의 라우팅 테이블을 모든 외부 트래픽을 트랜짓 게이트웨이로 보내도록 설정하고 모든 스포트(spoke) VPC가 공유 서비스 VPC의 NAT 게이트웨이를 사용할 수 있도록 설정한다.
![](https://csocrates-s3.s3.ap-northeast-2.amazonaws.com/%ED%8A%B8%EB%9E%9C%EC%A7%93%20%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%B4%20%EC%A0%84%EC%9D%B4%20%EB%9D%BC%EC%9A%B0%ED%8C%85%20%EC%97%B0%EA%B2%B0%20%ED%99%9C%EC%84%B1%ED%99%94%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-08-04%20%EC%98%A4%ED%9B%84%204.53.01.png)

### 참고
기존 방식으로는 다수의 피어링 연결을 사용하거나 타사 소프트웨어를 사용해야 했다.
#### 문제
1. 단일 장애점
	- 모든 인터넷 트래픽이 하나의 NAT 게이트웨이로 진행됨으로 해당 NAT 게이트웨이가 장애 발생하면 모든 VPC 인터넷 연결에 문제가 발생할 수 있음
2. 대역폭 및 성능문제
	- 하나의 NAT 게이트웨이에 트래픽이 몰리면 대역폭 문제가 발생할 수 있음
### 참고 레퍼런스
- [AWS Direct Connect](https://aws.amazon.com/ko/directconnect/)