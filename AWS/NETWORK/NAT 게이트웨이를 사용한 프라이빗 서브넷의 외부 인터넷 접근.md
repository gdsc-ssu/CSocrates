### 목차
- [[#문제 상황]]
- [[#문제 설명]]
- [[#해결 방법]]
- [[#참고]]
### 문제 상황
인터넷 게이트웨이에 대한 경로를 가진 퍼블릭 서브넷을 활용해 프라이빗 서브넷의 인스턴스에 외부 인터넷 접근을 허용해야한다.
### 문제 설명
프라이빗 서브넷은 보안상의 이유로 인터넷 게이트웨이를 통해 직접 인터넷에 접근할 수 없도록 설계되었습니다.
하지만 외부 서비스(소프트웨어 업데이트 등)에 접근이 필요할 경우가 존재할 수 있습니다.
이때 프라이빗 서브넷은 외부로의 인터넷 접근이 불가능함으로, 아예 외부 네트워크를 사용할 수 없습니다.
즉 여기서 원하는 상황은 외부에서 프라이빗 서브넷으로 접근은 막고, 프라이빗 서브넷에서 외부로 접근은 허용하는 방법을 찾는 중입니다.
### 해결 방법
퍼블릭 서브넷 중 하나에 NAT 게이트웨이를 생성하고, 탄력적 IP 주소를 생성하고 NAT 게이트웨이와 연결합니다.
프라이빗 서브넷과 연결된 라우팅 테이블에 NAT 게이트웨이를 대상으로 하는 인터넷 트래픽에 대한 경로를 추가합니다.

![](https://csocrates-s3.s3.ap-northeast-2.amazonaws.com/NAT%20%EA%B2%8C%EC%9D%B4%ED%8A%B8%EC%9B%A8%EC%9D%B4%EB%A5%BC%20%EC%82%AC%EC%9A%A9%ED%95%9C%20%ED%94%84%EB%9D%BC%EC%9D%B4%EB%B9%97%20%EC%84%9C%EB%B8%8C%EB%84%B7%EC%9D%98%20%EC%99%B8%EB%B6%80%20%EC%9D%B8%ED%84%B0%EB%84%B7%20%EC%A0%91%EA%B7%BC%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-07-14%20%EC%98%A4%EC%A0%84%2012.43.56.png)
다음과 같은 순서로 작동할 수 있습니다.
1. 인스턴스 1에서 외부 인터넷으로 요청을 전송
2. 프라이빗 서브넷에 있는 라우팅 테이블에 있는 설정대로 퍼블릭 티어에 있는 NAT 게이트웨이로 이동
3. NAT 게이트웨이는 요청을 자신의 공인 IP로 변경하여 인터넷 게이트웨이를 통해 외부 인터넷을 전송
4. 응답이 들어오면 NAT 게이트웨이가 이 응답을 프라이빗 서브넷으로 전달


### 참고
결국 해당 챕터에서 말하고 싶은 부분은 인터넷의 아웃바운드 엑세스를 허용하면서 내부 리소스에 대한 인바운드 엑세스는 허용하지 않는 서브넷 계층의 네트워크 아키텍처를 구성합니다.

NAT 게이트웨이를 통과하는 모든 통신은 연결한 EIP 주소를 가진다.
따라서 외부 공급업체의 허용 목록에 IP를 추가해야하는 경우 NAT 게이트웨이의 EIP를 화이트리스트로 등록할 수 있습니다. (EIP는 프로비저닝된 상태를 유지하는 한 바뀌지 않는다.)
예시) 
	[페이플](https://www.payple.kr/)이라는 간편 결제 회사에선 서비스에서 보안상의 이유로 서버에 접속할 수 있는 IP를 1개만 허용합니다. (이외의 접근하는 IP는 차단)
	일반적으로 AWS를 사용하면 서버에서 나가는 아웃바운드의 IP는 계속 변동될 수 있기 때문에 NAT 게이트웨이를 사용하여 아웃바운드로 나가는 IP를 고정적으로 EIP로 발급받은 값으로 유지할 수 있습니다. 


IPv6를 지원하는 VPC를 생성한 경우에는 [송신 전용 인터넷 게이트웨이](https://docs.aws.amazon.com/ko_kr/vpc/latest/userguide/egress-only-internet-gateway.html)를 참고하면 프라이빗 서브넷에 대한 아웃바운드 트래픽을 허용하는 아웃바운드 전용 인터넷 게이트웨이를 생성할 수 있습니다.

