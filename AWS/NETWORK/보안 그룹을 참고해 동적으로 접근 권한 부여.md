### 목차
- [[#문제 상황]]
- [[#문제 설명]]
- [[#해결 방법]]
- [[#참고]]
- [[#레퍼런스]]
### 문제 상황
2개의 인스턴스로 구성된 애플리케이션 그룹 사이에 SSH를 허용해야한다. 또한 향후 인스턴스 수가 증가해도 이를 손쉽게 적용할 수 있어야한다.
### 문제 설명
새로운 인스턴스가 추가될 때마다 수동으로 보안 그룹 규칙을 업데이트하는 방법은 번거롭고 오류가 발생할 가능성이 높습니다.
또한 여기서 말하는건 보안 그룹을 한 번에 적용하는 것을 원합니다.
### 해결 방법
동일한 보안 그룹을 여러 EC2 인스턴스의 ENI(Elastic Network Interface)에 연결하더라도 이들 간의 통신은 불가능합니다.
![](https://csocrates-s3.s3.ap-northeast-2.amazonaws.com/%EB%B3%B4%EC%95%88%20%EA%B7%B8%EB%A3%B9%EC%9D%84%20%EC%B0%B8%EA%B3%A0%ED%95%B4%20%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C%20%EC%A0%91%EA%B7%BC%20%EA%B6%8C%ED%95%9C%20%EB%B6%80%EC%97%AC%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-07-14%20%EC%98%A4%EC%A0%84%201.20.37.png)
보안 그룹을 생성하고 두 EC2의 인스턴스의 ENI에 연결합니다. 마지막으로 보안 그룹이 TCP 포트 22에 도달에 승인하는 수신 규칙을 생성합니다.
![](https://csocrates-s3.s3.ap-northeast-2.amazonaws.com/%EB%B3%B4%EC%95%88%20%EA%B7%B8%EB%A3%B9%EC%9D%84%20%EC%B0%B8%EA%B3%A0%ED%95%B4%20%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C%20%EC%A0%91%EA%B7%BC%20%EA%B6%8C%ED%95%9C%20%EB%B6%80%EC%97%AC%20/%20%EC%8A%A4%ED%81%AC%EB%A6%B0%EC%83%B7%202024-07-14%20%EC%98%A4%EC%A0%84%201.20.49.png)


### 참고
기존에는 정적 참고 방식으로 [CIDR](https://aws.amazon.com/ko/what-is/cidr/) 범위를 조정하여 방화벽을 구성하였지만, 이 경우는 인스턴스를 추가하거나 삭제하는 경우 동적으로 변경하기 어렵기 때문에 확장성이 떨어진다.
또한 여러 보안 그룹을 하나의 ENI와 연결할 수 있다.

> [!info] 보안 그룹을 삭제할 수 없는 경우
> - 현재 ENI에 연결되어있는 경우
> - 다른 보안 그룹(자신 포함)에서 참고하고 있는 경우

또한 우리가 평소에 ec2 인스턴스를 만들 때 이런 식으로 만들어진다고 생각하지만
![](https://csocrates-s3.s3.ap-northeast-2.amazonaws.com/%EB%B3%B4%EC%95%88%20%EA%B7%B8%EB%A3%B9%EC%9D%84%20%EC%B0%B8%EA%B3%A0%ED%95%B4%20%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C%20%EC%A0%91%EA%B7%BC%20%EA%B6%8C%ED%95%9C%20%EB%B6%80%EC%97%AC%20/%20Pasted%20image%2020240714011353.png)
실제로는 다음과 같은 형태로 만들어진다.
![](https://csocrates-s3.s3.ap-northeast-2.amazonaws.com/%EB%B3%B4%EC%95%88%20%EA%B7%B8%EB%A3%B9%EC%9D%84%20%EC%B0%B8%EA%B3%A0%ED%95%B4%20%EB%8F%99%EC%A0%81%EC%9C%BC%EB%A1%9C%20%EC%A0%91%EA%B7%BC%20%EA%B6%8C%ED%95%9C%20%EB%B6%80%EC%97%AC%20/%20Pasted%20image%2020240714011336.png)
### 레퍼런스
- [# ENI란? 쉽게 개념 및 특징 정리](https://jibinary.tistory.com/133#Elastic%C2%A0Network%C2%A0Interface-1)
