
# 3.1 S3 수명 주기 정책을 사용한 스토리지 비용 절감

#### 문제 설명

자주 사용하지 않는 객체를 운영 오버헤드를 추가하지 않고 비용 효율적인 스토리지 계층으로 전환하고자 한다. 

> [!왜?]
> **비용 절감** : 자주 사용하지 않는 데이터를 저렴한 스토리지로 자동 이동시켜 비용을 줄일 수 있다. 
> 
> **자동 정리** : 오래된 또는 필요 없는 데이터를 설정한 기간 후에 자동으로 삭제하여 저장 공간을 효율적으로 관리한다. 
> 
> **데이터 관리 간소화** : 수동으로 데이터를 관리할 필요 없이 원하는 방식대로 데이터의 저장 및 삭제를 자동화 할 수 있다. 



#### 해결 방법

30일 이후에 S3 IA(Infrequent Acces) 스토리지 클래스를 전환하는 S3 수명 주기 정책을 생성하고 S3 버킷에 적용한다. 


![[Pasted image 20240820112037.png]]


#### 실습

![[Pasted image 20240820102037.png]]

버킷을 만들고 관리 tab에 들어가면 life cycle rule을 설정할 수 있습니다. 


![[Pasted image 20240820102539.png]]

- 수명 주기 규칙 이름
	- 이름은 명시적 용도로 작성하는 것이 좋다. (구체적으로 잘 적으라는 이야기)
- 규칙 범위 선택
	- 하나 이상의 필터를 사용하여 이 규칙의 범위 제한 -> 버킷의 특정 파일들만 규칙을 적용시키는 옵션이다. 
- 접두사 
	- 적용할 폴더를 입력해준다. 이 때 ==버킷 명을 제외==하고 입력해야 하고, 경로도 ==상세하게 입력==해준다. 
- + 객체 태그

**tagging**
하나 이상의 필터를 사용하여 이 규칙의 범위 제한을 선택 후 객체 태그에 Filtering 적용 할 태그 값을 지정해준다. 
Tagging은 Console에서 Object를 클릭하여 객체 작업 창의 태그 편집으로 할 수 있고, Sdk를 사용해서 넣을 수도 있다. 



![[Pasted image 20240820103231.png]]

**[전환 작업]**

현재의 스토리지 클래스에서 다른 스토리지 클래스로 데이터를 자동으로 이동시킬 수 있다.

예를 들어, 객체 생성 후 30일동안 액세스가 없었으면 S3 Standard-IA 스토리지 클래스로 전환하거나, 1년이상 액세스가 적거나 없었으면 S3 Glacier 스토리지 클래스로 전환한다.

**[만료 작업]  

만료작업은 객체가 일정 기간 후에 자동으로 삭제되도록 설정하는 기능이다.  
이 기능은 특히 **임시 파일, 로그, 중요하지 않은 데이터** 등을 자동으로 정리하는 데 유용하게 사용된다

예를 들어, 30일 후에 자동으로 삭제되도록 설정한 객체는, 생성 또는 마지막 수정된 날짜로부터 30일이 지나면 자동으로 삭제됩니다.


버킷은 버전관리가 된다. 버전에 따라서도 클래스 변환을 할 수 있다. 

[스토리지 클래스 간에 객체의 현재 버전 전환]
객체의 현재 버전으 다른 스토리지 클래스로 이동시키는 것이다. 예를 들어, 객체를 '표준' 클래스에서 'S3-Intelligent Tiering' 또는 S3-Glacier'로 이동할 수 있다. 


[스토리지 클래스 간에 객체의 이전 버전 전환]
객체의 이전 버전들을 다른 스토리지 클래스로 이동시킨다. 버전 관리가 활성화 된 상태에서, 이 옵션은 오래된 객체 버전을 더 저렴한 스토리지로 옮겨 저장 비용을 줄이는 데 도움이 된다. 

>[!버전]
>이전 버전이란 버킷을 생성할 때 버전관리를 활성화 시키면 사용자가 실수로 버킷안의 데이터를 삭제해도 버킷의 저장된 데이터들은 버전별로 저장되기 때문에 복구가 가능하다. 그래서 데이터를 수정하거나 작업을 하면 새로운 버전이 생기고 여러개의 이전 버전들이 생겨난다. 


[객체의 현재 버전 만료]
설정된 기간이 지나면 객체를 삭제한다. 예를 들어, 30일 후에 현재 버전을 삭제할 수 있다. 


[객체의 이전 버전 영구 삭제]
이전 버전 객체를 설정된 시간 후에 자동으로 삭제한다. 저장 공간을 효율적으로 관리하고 비용을 절감하는데 도움이 된다. 


![[Pasted image 20240820110401.png]]


# 3.2 S3 Intellijent-Tiering 아카이브 정책을 사용한 S3 객체 자동 이동


#### 문제 설명
자주 엑세스하지 않는 객체를 성능 저하 없이 운영 오버헤드를 추가하지 않고 다른 아카이브 스토리지 크래스로 자동 전환하고자 한다. 

#### 해결 방법
90일 이상 된 객체에 대한 엑세스 패턴을 기반으로 객체를 S3 Glacier 아카이브로 자동화하는 정책을 생성한 뒤 버킷에 적용한다. 


![[Pasted image 20240820112050.png]]

뭐 바꿔주는 게 똑 같죠? 

이 타이밍에 Intelligent Tiering (지능형 티어링) 과 Lifecycle Rules(수명 주기 규칙)의 차이점을 정리하고 가도록 하겠습니다.

#### 1. Intelligent Tiering 

- 목적 : 사용자의 엑세스 패턴에 따라 객체를 자동으로 가장 비용 효율적인 스토리지 클래스로 이동시켜 비용을 절감한다. 

- 작동 방식 : 객체의 엑세스 빈도를 자동으로 모니터링하여, 자주 엑세스되는 데이터는 Frequent Access 티어에 유지하고 자주 엑세스 되지 않는 데이터는 Infrequent Access 티어로 이동한다. 이 모든 과정은 자동으로 이루어지며, 별도의 작업 없이 비용 최적화를 제공한다. 

- 주요 특징
	- 데이터에 대한 엑세스 패턴이 불규칙하거나 예측하기 어려운 경우에 적합하다. 
	- 자동으로 데이터를 적절한 티어로 이동시켜 주기 때문에 추가 설정 없이도 최적의 비용을 유지할 수 있다. 

#### 2. Life Cycle Rules

- 목적 : 데이터를 저장하는 동안 특정 시점이나 조건에 따라 데이터를 다른 스토리지 클래스로 이동시키거나 삭제하여 비용을 절감한다. 

- 작동 방식 : 사용자가 미리 정의한 규칙에 따라 객체를 자동으로 이동시키거나 삭제한다. 예를 들어, 데이터가 생성된지 30일이 지나면 Standard-IA 클래스로 이동 시키고, 365일이 지나면 Glacier 클래스로 이동시키며, 7년이 지나면 데이터를 삭제하는 규칙을 설정할 수 있다. 

- 주요 특징
	- 특정 시점에 따라 데이터를 관리하려는 경우에 적합하다. 
	- 데이터의 수명 주기를 명확히 정의하고, 그에 따라 비용을 절감할 수 있다. 



==객체 크기 또는 보존 기간에 상관없이 액세스 패턴을 알 수 없거나 예측할 수 없는, 또는 액세스 패턴이 변화하는 데이터==의 경우 S3 Intelligent-Tiering이 이상적인 스토리지 클래스이다.

#### Cost
**약간의 월별 객체 모니터링 및 자동화 요금만 지불**
체가 S3 Intelligent-Tiering 스토리지 클래스 내의 액세스 티어 간에 이동될 때는 계층화 요금이 추가로 적용되지 않는다. 

![[Pasted image 20240820115219.png]]


![[Pasted image 20240820115240.png]]


![[Pasted image 20240820115313.png]]

#### Intelligent-Tiering 스토리지 클래스

1. **Frequent Access**: 처음에 업로드된 데이터는 자동으로 이 티어에 저장된다. 
2. **Infrequent Access**: 30일 동안 액세스되지 않은 데이터는 이 티어로 이동된다.
3. **Archive Instant Access**: 90일 동안 액세스되지 않은 데이터는 이 티어로 이동된다.

**추가 선택 사항**으로, 두 가지 아카이브 티어를 활성화할 수 있다:

4. **Archive Access (아카이브 액세스)**: 90일 동안 액세스되지 않은 데이터가 이 티어로 자동 아카이브된다. 이 티어는 밀리초가 아닌 분에서 시간 단위로 데이터를 복구할 수 있다.
   
   목적은 아카이브 목적이다. (S3 Glacier)
   
5. **Deep Archive Access (딥 아카이브 액세스)**: 180일 동안 액세스되지 않은 데이터가 이 티어로 자동 아카이브된다. 이 티어는 가장 낮은 비용을 제공하며 데이터 복구 시간은 시간 단위이다.
   
   장기 보존 목적이다. (S3 Glacier Deep Archive)

> 화면에 2가지 엑세스 tier만 보이는 이유

**Frequent Access**, **Infrequent Access**, **Archive Instant Access** 이 세 가지 티어는 **Intelligent-Tiering** 클래스의 기본 기능으로, 자동으로 데이터의 액세스 패턴을 모니터링하여 적절한 티어로 데이터를 이동시킨다. 이 티어들은 사용자 개입 없이 자동으로 작동하기 때문에, 설정 시 별도로 선택하거나 구성할 필요가 없다. 따라서 설정 화면에서는 아카이브 관련 두 가지 옵션만 제공되는 것이다.

