# 서버리스

클라우드 네이티브

- 소프트웨어 설계

인스턴스 패칭 적용

- 실행중에 변경 가능
- 블루 그린 배포? 무중단 인스턴스 배포 가능

아마존에서 오토스케일링이 안되는 것도 많은데 왜 오토스케일링이 서버리스의 장점인가?

- 로드벨런서를 안 붙여도 되니까 서버리스에서의 장점이 되지 않을까

패칭

- 람다를 킨다는게 기계를 빌리는게 아닌 컨테이너 관리

서비리스의 가장 큰 장점은?

- 빠른 배포, 비용 절감

# 람다

이벤트를 통해 다른 동작을 불러와줌

변경에 의해서만 이벤트가 발생하나?(get 요청 빠지나?)

- Get 도 받음
- http 메서드랑 같이 이벤트를 받을 수 있음
- 람다는 실제 로직이 돌아가는 부분이고 http 처리해주는 로직은 api gateway를 통해

람다는 호출될때만 비용 발생

람다와 게이트 웨이 api 는 따로 청구됨

람다 특징

- 런타임
    - 최대 300초 런타임만 허용
- 공간
    - 최대 512MB
    - Lambda함수가 구동할 때 가상 컨테이너를 통해 가상 공간이 만들어짐
    - 도커와 같음
    - /tmp/
- 허용 패키지
    - 50MB 패키지 허용 가능
    - 초과시 S3 버킷 사용
        - 애초에 50MB 초과하면 서비리스를 사용하는게 아니라 인스턴스를 사용하는게 좋지 않을까

도커

- 프로세스 격리된 기술을 사용한 컨테이너
- 어느 환경에서도 똑같은 코드로 돌아가게 할 수 있도록 해줌
- 애플리케이션과 그 종속성을 다른 환경에서도 동일하게 작동하게 함
- VM -> AWS의 EC2 기본 엔진
    - 높은 수준의 격리와 보안이 중요할때
- 컨테이너
    - OS가 없음
    - 느린 가상화방식을 해결할 수 있는 프로세스 격리 방안
    - 종속성만 가져가면 됨
    - 경량, 빠른시작, 리소스 효율성이 필요한 경우

람다 사용 사례

- S3 버킷 파일 업로드
- 아두이노 활용
    - 온도 데이터 수집을 총해 데이터 전처리

람다 함수는 즉 중간다리 역할

이벤트에 의해 실행되서 스스로 동작하는 것이 아니라 전제 조건이 만족되어야 실행됨

람다의 조심

- 리스폰스 형태를 그대로 맞춰줘야 함
- Api gatway랑 항상 붙어서 동작하는데 안붙여도 할 수 있는데 붙이는게 처리나 보안면에서 추천

계정 동시성

- 람다가 많이 콜되면 비용이 많이 들 수 도 있고 해서 일부로 막아둠
- 이 숫자 안에서 오토스케일링이 일어남

디비커넥션을 관리해주는 서비스가 있음

# 로드밸런싱

로딩 분산

트래픽이나 요청 부하를 균등하게 분할하는 기법

예시로 은행에서 번호표를 뽑는 것과 같음

그래서 로드밸런싱 왜 하나?

- 슈퍼컴퓨터가 있다면 이 컴퓨터 하나에서 모든걸 할 수 있고 관리도 쉬울수도 있지만 실제로는 이게 안되니까
- 컴퓨터를 여러대로 쪼개개 됨
- 이러면 어떠한 컴퓨터에게 어떻게 적절하게 분배를 하게 되나가 문제가 됨
    - 스케일 아웃 업의 한계때문에 스케일 아웃이 필요하게 되었고 이를 위해 로드밸런싱이 필수적이게 됨

로드밸런서

- 프록시의 사용 예시 중 하나

클라이언트 -> 포워트 프록시 -> 인터넷 -> 리버스 프록시 -> 서버

포워트 프록시

- 대표적으로 캐시, CDN
    - 사이트에 접속한다고 하면 광고가 들어있음
- VPN
- 요약하면 클라이언트 정보를 숨길 수 있고 캐싱할 수 있음

리버스 프록스

- 캐싱, 보안, 로드밸런싱
- nginx를 떠올리면 쉬움
- 클라이언트의 주소도 숨길 수 있음
- 서버와 인터넷 사이에 있어서 서버에 넘어가기 전에 한 번 거치는 것

그래서 프록시란?

- 클라이언트, 인터넷, 서버 사이에 있으면 다 프록시가 됨
- 어떻게 쓰느냐에 따라 달라진다는 것
- 그래서 로드밸런서 또한 인터넷 -> 서버 사이에 존재함

로드밸런서가 로드밸런싱을 위해 하는 일

- 헬스체크
    - 핵심은 주기
        - 얼마나 짧게 할 건지 길게 할건지
- NAT
    - 사실 <-> 공인 아이피 변환 진행
- DSR
    - 클라이언트 -> 인터넷 -> 서버 진행 방향에서 다시 서버에서 클라이언트로 넘어갈 때 서버에서 인터넷으로 로드밸런서를 통해서 지나가면 무리가 있으니 바로 클라이언트에게 넘겨줄 수 있게 하는 것
- 터널링

로드밸런싱은 어떻게 하나?

- 알고리즘의 종류
    - 라운드 로빈
        - 순서대로 요청을 전달
        - 단점
            - 요청의 종류를 알 수 없음
                - 균등하게 배분했지만 만약 어느 한 인스턴스가 긴 요청을 받았을 경우 그 요청을 받은 인스턴스는 고통받을 수 밖에 없음
        - 라운드 로빈 알고리즘으로 로드밸런서를 쓰면 좋은 경우
    - 최소 연결 방식
        - 현재 연결된 세션 수가 가장 적은 서버에 요청을 할당하는 방식
            - 예시로 가게에 줄이 가장 짧은 순서로 요청을 보내줌
            - 하지만 이것도 각 요청이 긴지 짧은지 모른다는 점이 있음
    - 리소스 기반 방식
        - 헬스체크를 통해 각 서버에서 동작중인 에이전트로부터 서버의 현재 리소스 현황를 전송받고 이를 기반으로 가장 리소스가 여유있는 서버에게 요청 전단
        - 오버헤드 발생 가능성 있음

로드밸런서의 종류

- L4 로드밸런서
    - Transport layer
    - 간단하고 빠르고 쌈
- L7 로드밸런서
    - Application layer
    - 느리고 비싸지만 자세함

# **VPC Reachability AnalyzerVPC Reachability Analyzer**

Aws 버전 traceroute

- 네트워크 트레이스 용 도구로 내 AWS 인스턴스간의 네트워크 연결 방식을 트레이싱하고 분석하는 것을 도와주는 도구
- 인스턴스 접근 가능 여부를 확인 할 수 있음

로드벨런서가 SSL/TLS를 해주냐?

- 그냥 로드밸런서가 해줌