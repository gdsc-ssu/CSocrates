### RestfulAPI

### API Gateway

규모에 상관없이 API 생성, 유지, 관리, 모니터링과 보호를 할 수 있게 해주는 서비스

클라에서 서버로 통신할 때 API들이 대문 역할을 함

유형

- RESTful API
- WEBSOKET API

### API Gateway 패턴

마이크로 서비스로 나눠진 백엔드 서버들 앞에 하나의 api gateway를 둠으로써 클라이언트는 api gateway에 노출된 경로만 호출하고 요청된 라우트에 따라 적정한 서비스로 라우팅 시키고 response를 내려주는 것

### MSA

토스에서 Gateway를 쓰는 방식

### 질문

API Gateway언제 사용?

MSA할때 쓸 수 있음

Q. get은 캐싱 가능, post는 캐싱 불가능. 그러면 캐싱의 주체는?

A. 멱등성이 지켜지는 get만 캐싱가능한게 맞음. 어떻게 캐싱하느랴에 따라 달라질 것 같긴 한데 정적 파일은 ngix 아님 왓슨 딴에서 하기도 함

웹서버에서도 가능하고 왓슨에서도 가능함. 캐싱은 geta만 가능

Q. RSET의 조건에 따르는 stateless한데 세션이나 쿠키를 쓰면 stateful 해짐?

A. 세션을 사용하면 stateful해짐. 근데 토큰을 사용하면 stateless유지 가능함

그래서 RESTful의 조건은 세션을 사용하지 않아서 stateless해야한다는 것 같음

Q. RESTful API의 단점?

A. stateless가 항상 좋은 건 아님. 토큰 방식보다 세션 방식이 보안에 더 좋은 경우가 있음. 그리고 stateless가 토큰을 발행해야하니까 네트워크 더 잡아먹을 수 있음

Q. MVC에서 컨트롤러만 쓰는게 아니라 model도 쓰지 않나?

A. 다들 controller만 쓴다고 함

---

### CICD

CI

지속적 통합이라는 뜻으로 소프트웨어 개발에서 코드 변경 사항을 자주 통합하고 자동으로 빌드 및 테스트하는 프로세스

CD

지속적 배포로 코드 변경 사항이 자동으로 빌드되고 테스트된 후 프로덕션 환경으로 배포할 수 있는 상태로 유지되는 프로세스

CI/CD는 함께 공존

소프트웨어 개발은 많은 과정을 거치는데 이는 개발자가 모두 관리하기 어렵고 실수의 가능성이 있으니 CICD를 사용해 자동화 개념을 도입하여 편리하게 해줌

장점

- 소프트웨어 개발 시 반복적 작업을 모두 자동화
- 점진적 변화 가능

### 레포지토리

코드를 보관하며, 회사나 단체에 수 많은 개발자 코드를 공유하고 수정하는 곳

- 깃허브

단순 코드 업로드하고 보관하는 기능 용도로만 사용되지 않는데, 웹사이트 호스팅도 가능하고 aws 힘을 빌려 CICD 기능을 깃허브와 함께 사용하여 테스트를 자동화할 수 있음

### 깃허브 브랜치

깃이 합쳐지는 원리

- 데이터를 스냅샷으로 저장하여 파일 시스템의 상태를 기록하는 방식
    - 오브젝트 데이터베이스
        - 볼롭(실제 콘텐츠를 저장), 트리, 커밋
    - 브랜치
        - 특정 커밋을 가리키는 가벼운 포인터
    - 병합 과정
        - 구 브랜치가 병합할 때 브랜치의 공통 조상(커밋)을 찾음
        - 그리고 3-way 머지를 수행
    - 깃 내부 알고리즘
        - diff3

### AWS code commit

장점

- aws 생태계 긴밀한 통합
    - IAM을 통해 관리 가능
- 보안 및 규정 준수
- 무제한 저장소 파일크기 제한 없음
- 높은 가용성과 내구성
- 비용 구조

### 코드 배포

CICD파이프 라인에서 가장 큰 비중

코드 배포는 자동배포인데 레포에서 새로운 코드 수정 및 업데이트 발생시 코드 배포는 이를 감지한 후 프로덕션으로 배포할 준비를 함

**코드 배포 방법**

1. 롤링 배포
    
    점측적 배포
    
    최근에 배포한 기능에서 버그가 발생되어 이전 버전으로 돌아가야한다면?
    
    롤릴배포는 한 번에 이전 버전으로 돌아갈 수 없음
    
2. 블루그린 배포
    
    블루는 현재돌아가고 있는 프로덕션, 그린은 새로 배포할 인스턴스
    
    목표는 블루를 완전 셧다운 시키고 그린을 100퍼 활성화시키는 것
    
    블루 그린 배포는 이전 버전과 최신 버전의 전환이 용이함
    

그럼 블루 그린 배포가 더 좋냐?

처음 배포할때는 롤링 배포가 더 빠른 배포가 가능하기 때문에 좋음

### 코드 파이프라인

개발자가 해야할 일은 이벤트와 맞는 트리거를 적용하는 것

코드 커밋에서 특정 코드가 변경되었다면 코드 파이프라인은 이를자동으로 감지하고 빌드를 진행하라는 트리거를 진행시킬 수 있음

### 질문

Q. 코드 배포할때 인스턴스가 늘어나는걸로 보이는데 자원이 두배 늘어나는건지 애초부터 배포를 위해 자원을 잡아놓고 있어야하는건지?

A. 롤릴 배포는 하나 올리고 하나 끄고 이런 방식 블루그린 배포는 다른 인스턴스에 모든 트래픽을 넘기고 꺼짐 그래서 2배가 나오는게 사실?

Q. 블루그린 배포에서 롤백시킬 때 이전버전 갈려면 블루로 돌아가면 롤백된다는 거 같은데 버전 두개를 롤백시키고 싶을때는?

A. 롤백이 쉽다고 하는 이유는 모든 트래픽을 옮겨야 하는데 타이머를 설정해서 옮길 수 있기 때문인거 같은데 두개를 넘길려면 다시 배포하는게 맞음?

Q. 깃허브 액션이 실제로 좋은가?

A. jenkins는 어려움, travis는 비쌈

물론 큰 배포를 할때는 jenkins로 넘어가긴함

Q. 롤링 배포가 처음 배포할때 좋다는데 처음 배포가 어떻게 좋은 건지?

A. 롤링 배포는 시스템에 점진적으로 변화를 적용하는 것이기 때문에 리스크를 더 세분화해서 관리할 수 있지만, 블루-그린 배포는 새로운 버전을 완전히 준비한 후 한 번에 전환하기 때문에 준비 과정에서 더 많은 자원(예: 두 개의 완전한 환경 유지)이 필요

Q. 롤링 배포는 자동으로 인스턴스를 껐다 켰다 가능한지

A.

- **Kubernetes**: Kubernetes는 롤링 업데이트 전략을 자동으로 수행할 수 있습니다. 새로운 버전의 파드를 순차적으로 생성하면서 기존 파드를 종료합니다.
- **AWS Elastic Beanstalk**: Elastic Beanstalk에서도 롤링 배포를 자동으로 관리해줍니다. 일부 인스턴스를 새 버전으로 업데이트한 뒤 문제가 없으면 나머지 인스턴스에 동일한 과정을 반복합니다.
- **CI/CD 파이프라인 도구**: Jenkins, GitLab CI 등에서도 롤링 배포를 설정할 수 있으며, 배포 파이프라인이 설정되면 인스턴스의 중단, 업데이트, 검증 등이 자동으로 이루어집니다.

롤링 배포에서 인스턴스를 껐다 켜는 작업은 대부분의 경우 배포 도구가 자동으로 처리해줌