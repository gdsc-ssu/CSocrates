### 수명 주기 규칙을 이용한 S3

문제 : 자주 사용하지 않은 객체를 운영 오버헤드를 추가하지 않고 비용 효율적인 스토리지 계층으로 전환하고자 한다

**S3 IA**

접근 속도가 빠름

그래서 자주 활용하는 데이터 위주로 저장

→ 30일 이후 사용하지 않는 데이터를 싼 버킷으로 옮기고자 함

→ 수명 주기 규칙을 만들어서 관리

전환 작업

만료 작업

### 아카이브 정책을 이용한 S3

문제 : 자주 엑세스 하지 않는 객체를 성능 저하 없이 오버헤드를 추가하지 않고 다른 아카이브 스토리지 클래스로 자동 전환하고자 한다

처음에는 비싸지만 쓸수록 싸짐

수명 주기랑 다른 점이 intelligent tiering이 있어 사람이 설정하지 않아도 됨

intelligent tiering → 데이터를 모아야 하기 때문에 첫 한달은 딱히 작동을 안함

intelligent tiering을 쓰는것에 대해 돈이 나감

Q. 두 가지를 동시에 사용하면?

A. 둘 다 작동됨

---
### EC2로 블로그 띄우기

1. S3를 활용해 배포 → 쌈
2. EC2와 nginx활용 배포 → 명진상 초이스

정적 웹서버 및 https 적용을 위해 nginx활용

별도의 WAS서버가 존재하지 않기에 정적 웹서버라고 부름

이제 이 정적 웹서버에서 사용자의 요청을 처리하는 일이 필요

nginx 설정에서…

내 웹서버에서 http타입을 어떻게 처리할건지 설정 → http 블록

기본 웹서버는 http 헤더와 바디 제한이 없어서 누군가가 큰 파일을 보내면 서버에 엄청난 부하가 될 수 있음 → 설정해야함

실질적으로 내 웹서버에서 구동하는 서버 설정 → server 블록

root : 요청에 따라 응답으로 전달한 정적 파일 폴더의 기본 위치 설정

worker_processes

비동기로 처리

그래서 무작정 많은 경우 안 좋음

cpu코어수 보다 많이 설정하면 오히려 오버헤드 발생 가능

**블로그 설정하기**

마스터 하나 워커 하나

**웹서버에 https 설정**

CA인증서는 일반적으로 유로지만 let’s encrypt 사용하면 무료로 사용 가능함

단점 : 90일마다 인증해줘야 함

**도메인**

AWS Route53에서 도메인을 바로 살 수 있음

산 다음 호스팅 영역에서 도메인을 넣고

레코드에서 ECS 퍼블릭 ip를 넣으면 됨

다 만들었으니 구글 검색엔진에 사이트를 노출시켜야함

**SEO**

특정 사이트에 대해 웹 마스터 권한을 보유하기 위해 TXT값을 넣음

Q. SEO를 최적화 하는 것도 기술(윗 단에 띄우고 싶으면)

Q. EC2로 블로그 만들면 비용이 월 얼마?
A. 달에 5달러정도? EC2비용+Route53 해서 7-8달러 정도?

Q. 버셀로 배포하는게 더 좋지 않음?
A. 맞음. 근데 그냥 S3에 올리기만 해도 되긴 함. 굳이 정적 웹서버를 쓸 이유가 없음

SSG활용하면 정적 파일은 바로 내려놈 → 서버에서 미리 받아놓음

Q. 학생 수준에서 Nginx 필요한가?
A. 돈이 문제가 안된다면 보안성에서도 그렇고 nginx 띄우는게 좋음.
	정석은 붙이는게 맞는데 돈이 많이 들어서 안 붙여도 된다고 생각하긴 함

Q. nginx를 사용해서 어느 부분이 보안이 좋나?
A. 스프링에서 처리하기 애매한걸 처리해줄 수 있음. 그래서 보안 뿐만 아니라 효율성도 좋아짐
	http단을 nginx에서 만져줄 수 있기 때문에

Q. 대용량 트래픽을 처리하지 않는데 아파치의 장점은?
A. 연산 작업이 많은 경우 nginx를 사용하면 비동기처럼 되지 않기 때문에 이런 경우 아파치를 사용하는게 나음

Q. 컴퓨터 하나에서 웹사이트를 여러개 띄우고 싶은데, 하나의 포트에 여러개의 ip를 해서 다른 웹사이트로 넘기고 싶으면 어떻게 관리하는게 좋은지
A. 호스트 헤더 안에 어떤 도메인으로 가고 싶은지 관리함
	근데 커넥션 관련 재앙 발생 가능성이 있으니 최소 컨테이너단으로 분리는 필요

nginx가 워커 프로세스 단으로(블루그린) 업데이트 가능